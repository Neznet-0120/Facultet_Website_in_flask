{% extends "base_admin.html" %}

{% block title %}Управление расписанием - Админ панель{% endblock %}

{% block content %}
<div class="row">
    <div class="col-12">
        <div class="d-flex justify-content-between align-items-center mb-4 animate-fade-in-up">
            <h1 class="display-5 fw-bold">
                <i class="fas fa-calendar-alt me-3" style="color: var(--accent-gold);"></i>
                Управление расписанием
            </h1>
            <button class="btn btn-custom-primary" data-bs-toggle="modal" data-bs-target="#addScheduleModal">
                <i class="fas fa-plus-circle me-2"></i>Добавить занятие
            </button>
        </div>
    </div>
</div>

 Schedule Table 
{% if schedules %}
<div class="row">
    <div class="col-12">
        <div class="card-custom p-4 animate-fade-in-up">
            <div class="table-responsive">
                <table class="table table-custom">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>Группа</th>
                            <th>Курс</th>
                            <th>Предмет</th>
                            <th>Преподаватель</th>
                            <th>День недели</th>
                            <th>Время</th>
                            <th>Действия</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for schedule in schedules %}
                        <tr>
                            <td>{{ schedule.id }}</td>
                            <td>
                                <span class="badge badge-custom" style="background: var(--accent-gold); color: white;">
                                    {{ schedule.group.name }}
                                </span>
                            </td>
                            <td>{{ schedule.course }} курс</td>
                            <td>{{ schedule.subject.name }}</td>
                            <td>{{ schedule.teacher.username }}</td>
                            <td>
                                 Converting weekday number to day name 
                                {% set days = ['Понедельник', 'Вторник', 'Среда', 'Четверг', 'Пятница', 'Суббота', 'Воскресенье'] %}
                                {{ days[schedule.weekday] }}
                            </td>
                            <td>
                                 Displaying start and end time 
                                {{ schedule.start_time.strftime('%H:%M') }} - {{ schedule.end_time.strftime('%H:%M') }}
                            </td>
                            <td>
                                <div class="d-flex gap-2">
                                     Fixed parameter name from schedule_id to id 
                                    <a href="{{ url_for('edit_schedule', id=schedule.id) }}" 
                                       class="btn btn-sm btn-custom-primary">
                                        <i class="fas fa-edit"></i>
                                    </a>
                                     Changed to GET request and fixed parameter 
                                    <a href="{{ url_for('delete_schedule', id=schedule.id) }}" 
                                       onclick="return confirm('Вы уверены, что хотите удалить это занятие?');"
                                       class="btn btn-sm" 
                                       style="background: rgba(231, 111, 81, 0.2); color: var(--accent-orange); border: none;">
                                        <i class="fas fa-trash"></i>
                                    </a>
                                </div>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>
{% else %}
<div class="row">
    <div class="col-12">
        <div class="card-custom p-5 text-center animate-fade-in-up">
            <i class="fas fa-calendar-alt fa-4x mb-4" style="color: var(--text-muted);"></i>
            <h3 class="mb-3">Пока нет расписания</h3>
            <p style="color: var(--text-muted);">Создайте первое занятие</p>
            <button class="btn btn-custom-primary mt-3" data-bs-toggle="modal" data-bs-target="#addScheduleModal">
                <i class="fas fa-plus-circle me-2"></i>Создать занятие
            </button>
        </div>
    </div>
</div>
{% endif %}

 Add Schedule Modal 
<div class="modal fade" id="addScheduleModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content" style="background: var(--secondary-dark); border: 1px solid var(--border-color);">
            <div class="modal-header" style="border-bottom: 1px solid var(--border-color);">
                <h5 class="modal-title">
                    <i class="fas fa-plus-circle me-2" style="color: var(--accent-gold);"></i>
                    Добавить занятие
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" style="filter: invert(1);"></button>
            </div>
            <form method="POST" action="{{ url_for('admin_schedule') }}">
                <div class="modal-body">
                    <div class="row g-3">
                        <div class="col-md-6">
                            <label for="group_id" class="form-label-custom">
                                <i class="fas fa-users-cog me-2"></i>Группа
                            </label>
                            <select class="form-control form-control-custom" id="group_id" name="group_id" required>
                                <option value="">Выберите группу</option>
                                {% for group in groups %}
                                <option value="{{ group.id }}">{{ group.name }}</option>
                                {% endfor %}
                            </select>
                        </div>
                         Added course field 
                        <div class="col-md-6">
                            <label for="course" class="form-label-custom">
                                <i class="fas fa-graduation-cap me-2"></i>Курс
                            </label>
                            <select class="form-control form-control-custom" id="course" name="course" required>
                                <option value="">Выберите курс</option>
                                <option value="1">1 курс</option>
                                <option value="2">2 курс</option>
                                <option value="3">3 курс</option>
                                <option value="4">4 курс</option>
                            </select>
                        </div>
                        <div class="col-md-6">
                            <label for="subject_id" class="form-label-custom">
                                <i class="fas fa-book me-2"></i>Предмет
                            </label>
                            <select class="form-control form-control-custom" id="subject_id" name="subject_id" required>
                                <option value="">Выберите предмет</option>
                                {% for subject in subjects %}
                                <option value="{{ subject.id }}">{{ subject.name }}</option>
                                {% endfor %}
                            </select>
                        </div>
                        <div class="col-md-6">
                            <label for="teacher_id" class="form-label-custom">
                                <i class="fas fa-chalkboard-teacher me-2"></i>Преподаватель
                            </label>
                            <select class="form-control form-control-custom" id="teacher_id" name="teacher_id" required>
                                <option value="">Выберите преподавателя</option>
                                {% for teacher in teachers %}
                                <option value="{{ teacher.id }}">{{ teacher.username }}</option>
                                {% endfor %}
                            </select>
                        </div>
                         Changed day_of_week to weekday with numeric values 
                        <div class="col-md-6">
                            <label for="weekday" class="form-label-custom">
                                <i class="fas fa-calendar-day me-2"></i>День недели
                            </label>
                            <select class="form-control form-control-custom" id="weekday" name="weekday" required>
                                <option value="">Выберите день</option>
                                <option value="0">Понедельник</option>
                                <option value="1">Вторник</option>
                                <option value="2">Среда</option>
                                <option value="3">Четверг</option>
                                <option value="4">Пятница</option>
                                <option value="5">Суббота</option>
                                <option value="6">Воскресенье</option>
                            </select>
                        </div>
                         Split time into start_time and end_time 
                        <div class="col-md-6">
                            <label for="start_time" class="form-label-custom">
                                <i class="fas fa-clock me-2"></i>Время начала
                            </label>
                            <input type="time" class="form-control form-control-custom" id="start_time" name="start_time" required>
                        </div>
                        <div class="col-md-6">
                            <label for="end_time" class="form-label-custom">
                                <i class="fas fa-clock me-2"></i>Время окончания
                            </label>
                            <input type="time" class="form-control form-control-custom" id="end_time" name="end_time" required>
                        </div>
                    </div>
                </div>
                <div class="modal-footer" style="border-top: 1px solid var(--border-color);">
                    <button type="button" class="btn btn-custom-secondary" data-bs-dismiss="modal">Отмена</button>
                    <button type="submit" class="btn btn-custom-primary">
                        <i class="fas fa-save me-2"></i>Создать
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>
{% endblock %}
